<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>kubernetes RBAC | 我爱西红柿</title>
  <meta name="description" content="操作系统：centos7.3软件版本：   

kubernetes 1.8
docker-ce 17.03.02

概念：权限管理是指控制用户对某些特定资源的访问权限。设计理念ACL(访问控制列表):对资源进行权限控制，每个资源都有一个权限列表记录着哪些用户对这个资源能进行哪些操作，优点：实现非常简单，只需要将用户和资源连接起来就可以。缺点是：当用户和资源增多时会产生大量访问控制列表，管理起来非">
<meta property="og:type" content="article">
<meta property="og:title" content="kubernetes RBAC">
<meta property="og:url" content="http://yoursite.com/2018/02/26/kubernetes_rbac/index.html">
<meta property="og:site_name" content="我爱西红柿">
<meta property="og:description" content="操作系统：centos7.3软件版本：   

kubernetes 1.8
docker-ce 17.03.02

概念：权限管理是指控制用户对某些特定资源的访问权限。设计理念ACL(访问控制列表):对资源进行权限控制，每个资源都有一个权限列表记录着哪些用户对这个资源能进行哪些操作，优点：实现非常简单，只需要将用户和资源连接起来就可以。缺点是：当用户和资源增多时会产生大量访问控制列表，管理起来非">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_1.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_2.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_3.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_4.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_6.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_5.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_6.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_7.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_8.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_9.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_10.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_11.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_12.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_13.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_14.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_15.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_16.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_17.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_18.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_19.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_21.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_22.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_23.png">
<meta property="og:updated_time" content="2018-02-26T13:45:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kubernetes RBAC">
<meta name="twitter:description" content="操作系统：centos7.3软件版本：   

kubernetes 1.8
docker-ce 17.03.02

概念：权限管理是指控制用户对某些特定资源的访问权限。设计理念ACL(访问控制列表):对资源进行权限控制，每个资源都有一个权限列表记录着哪些用户对这个资源能进行哪些操作，优点：实现非常简单，只需要将用户和资源连接起来就可以。缺点是：当用户和资源增多时会产生大量访问控制列表，管理起来非">
<meta name="twitter:image" content="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_1.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://yoursite.com/2018/02/26/kubernetes_rbac/index.html">
  
    <link rel="alternate" href="/atom.xml" title="我爱西红柿" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  <!-- font-awesome CSS -->
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
    
    

</head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/wanshaoyuan" target="_blank">
          <img class="img-circle img-rotate" src="/images/image.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">我爱西红柿</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">OpenStack engineer &amp;&amp; devops</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="fa fa-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="fa fa-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      <!-- <span class="ins-close ins-selectable"><i class="fa fa-times"></i></span> -->
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav">
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="fa fa-fw fa-dashboard"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="fa fa-fw fa-delicious"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="fa fa-fw fa-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="fa fa-fw fa-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="fa fa-fw fa-gg"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="fa fa-fw fa-coffee"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wanshaoyuan" target="_blank" title="Github" ><i class="fa fa-github"></i></a></li>
        
        <li><a href="http://www.bldewan.com" target="_blank" title="Behance" ><i class="fa fa-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" ><i class="fa fa-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            
            <div class="content">
                <p>已知的已知，已知的未知，未知的未知</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ceph/">ceph</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kubernetes/">kubernetes</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/neutron/">neutron</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/openstack/">openstack</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ceph/">ceph</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/">kubernetes</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/neutron/">neutron</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/">openstack</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/操作系统/">操作系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Linux/" style="font-size: 13.83px;">Linux</a> <a href="/tags/Python/" style="font-size: 13.17px;">Python</a> <a href="/tags/ceph/" style="font-size: 13.33px;">ceph</a> <a href="/tags/docker/" style="font-size: 14px;">docker</a> <a href="/tags/kubernetes/" style="font-size: 13.67px;">kubernetes</a> <a href="/tags/neutron/" style="font-size: 13.5px;">neutron</a> <a href="/tags/openstack/" style="font-size: 13.83px;">openstack</a> <a href="/tags/安全/" style="font-size: 13px;">安全</a> <a href="/tags/操作系统/" style="font-size: 13px;">操作系统</a> <a href="/tags/数据库/" style="font-size: 13.17px;">数据库</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/kubernetes/">kubernetes</a>
              </p>
              <p class="item-title">
                <a href="/2018/03/26/rke部署kubernetes/" class="title">rke部署kubernetes</a>
              </p>
              <p class="item-date">
                <time datetime="2018-03-26T13:45:59.000Z" itemprop="datePublished">2018-03-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/kubernetes/">kubernetes</a>
              </p>
              <p class="item-title">
                <a href="/2018/03/11/kubernetes_ingress/" class="title">kubernetes ingress</a>
              </p>
              <p class="item-date">
                <time datetime="2018-03-11T13:45:59.000Z" itemprop="datePublished">2018-03-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/kubernetes/">kubernetes</a>
              </p>
              <p class="item-title">
                <a href="/2018/02/26/kubernetes_rbac/" class="title">kubernetes RBAC</a>
              </p>
              <p class="item-date">
                <time datetime="2018-02-26T13:45:59.000Z" itemprop="datePublished">2018-02-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/kubernetes/">kubernetes</a>
              </p>
              <p class="item-title">
                <a href="/2018/01/26/kubernetes_base/" class="title">kubernetes入门</a>
              </p>
              <p class="item-date">
                <time datetime="2018-01-26T13:45:59.000Z" itemprop="datePublished">2018-01-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/docker/">docker</a>
              </p>
              <p class="item-title">
                <a href="/2018/01/25/docker_storage_driver/" class="title">docker storage-driver</a>
              </p>
              <p class="item-date">
                <time datetime="2018-01-25T13:45:59.000Z" itemprop="datePublished">2018-01-25</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#概念："><span class="toc-number">1.</span> <span class="toc-text">概念：</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-kubernetes_rbac" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      kubernetes RBAC
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="fa fa-calendar-check-o"></i>
	<a href="/2018/02/26/kubernetes_rbac/" class="article-date">
	  <time datetime="2018-02-26T13:45:59.000Z" itemprop="datePublished">2018-02-26</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/kubernetes/">kubernetes</a>
  </span>

        
  <span class="article-tag">
    <i class="fa fa-tag"></i>
	<a class="article-tag-link" href="/tags/kubernetes/">kubernetes</a>
  </span>


        

        <span class="post-comment"><i class="fa fa-commenting-o"></i> <a href="/2018/02/26/kubernetes_rbac/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 2,935(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 12(分)</span>
	

      </div>
      
      <div class="toggle-toc hidden-xs" data-stick-top>
        <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
          <i class="text-collapsed fa fa-anchor"></i>
          <i class="text-in fa fa-close"></i>
        </a>
      </div>
      
    </div>
    <div class="article-entry markdown-body" itemprop="articleBody">
      
        <p>操作系统：<br>centos7.3<br>软件版本：   </p>
<ul>
<li>kubernetes 1.8</li>
<li>docker-ce 17.03.02</li>
</ul>
<h3 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h3><p>权限管理<br>是指控制用户对某些特定资源的访问权限。<br>设计理念<br>ACL(访问控制列表):对资源进行权限控制，每个资源都有一个权限列表记录着哪些用户对这个资源能进行哪些操作，优点：实现非常简单，只需要将用户和资源连接起来就可以。缺点是：当用户和资源增多时会产生大量访问控制列表，管理起来非常麻烦。<br>ABAC(基于属性的访问控制)：ABAC控制权限的粒度非常细，非常灵活；属性通常来说分为四类：用户属性、环境属性、操作属性、对象属性；ABAC通过动态的控制一组属性是否满足条件来进行授权判断。优点：权限控制的粒度非常细，非常灵活。缺点：太过于复杂。<br>例如规则：“禁止所有学生在上课时间进出校门”这条规则，其中，“学生”是用户的角色属性，“上课时间”是环境属性，“进出”是操作属性，而“校门”就是对象属性了。<br>RBAC(基于角色的访问控制)：引入角色概念，通过将权限和角色关联，来实现用户根权限的解耦，角色可以看做是权限的一个集合。通过权限与角色关联，角色与用户的关联可以实现用户和角色多对多的对应关系。优点 ；将权限与角色关联，用户关联角色，这样权限控制更加灵活 。缺点：相比ABAC控制的粒度没有那么细。<br>RBAC的模型<br>Who是否可以对What进行How的访问操作（Operator）    </p>
<p>kubernetes之前的版本都是使用ABAC做为权限管理控制，在kubernetes1.3发布alpha版本RBAC,在kubernetes1.6版本RBAC提升为Beta版，kubernetes1.8版本正式提升为GA版，为什么用RBAC取代ABAC是因为在kubernetes中ABAC过于复杂，不好管理，难以理解，RBAC相对功能和可管理性来说更加合适kubernetes。所以说没有更好，只有更合适。  </p>
<p>在kubernetes中的RBAC定义了四类API资源分别为：<br>Role：role是一组权限的集合，namespace范围的Role，role权限的有效范围为指定的单一namespace。<br>ClusterRole：clusterrole根role一样也是一组权限的集合，cluster范围的Role，但clusterrole的有效范围是整个集群的权限和一些集群级别的资源如：集群的node节点、非资源类型endpoint、跨所有命名空间的命名空间范围资源（例如pod，需要运行命令kubectl get pods –all-namespaces来查询集群中所有的pod）。<br>RoleBinding：将角色根用户或组或ServiceAccount绑定，授予它们对该命名空间资源的权限。<br>ClusterRoleBinding：将ClusterRole与用户绑定，授予它们对cluster的资源访问权限。  </p>
<p>例子<br>首先我们创建个wanshaoyuan的普通用户<br>确认kubernetes证书目录是否有以下文件<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_1.png" alt=""><br>若没有ca-config.json<br>创建一个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">cat &gt; ca-config.json &lt;&lt;EOF</div><div class="line">&#123;</div><div class="line">  &quot;signing&quot;: &#123;</div><div class="line">    &quot;default&quot;: &#123;</div><div class="line">      &quot;expiry&quot;: &quot;87600h&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;profiles&quot;: &#123;</div><div class="line">      &quot;kubernetes&quot;: &#123;</div><div class="line">        &quot;usages&quot;: [</div><div class="line">            &quot;signing&quot;,</div><div class="line">            &quot;key encipherment&quot;,</div><div class="line">            &quot;server auth&quot;,</div><div class="line">            &quot;client auth&quot;</div><div class="line">        ],</div><div class="line">        &quot;expiry&quot;: &quot;87600h&quot;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<p>ca-config.json：可以定义多个 profiles，分别指定不同的过期时间、使用场景等参数；后续在签名证书时使用某个 profile；<br>1、创建证书签名请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">cat &gt; wanshaoyuan-csr.json &lt;&lt;EOF</div><div class="line">&#123;</div><div class="line">  &quot;CN&quot;: &quot;wanshaoyuan&quot;,</div><div class="line">  &quot;hosts&quot;: [],</div><div class="line">  &quot;key&quot;: &#123;</div><div class="line">    &quot;algo&quot;: &quot;rsa&quot;,</div><div class="line">    &quot;size&quot;: 2048</div><div class="line">  &#125;,</div><div class="line">  &quot;names&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;C&quot;: &quot;CN&quot;,</div><div class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</div><div class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</div><div class="line">      &quot;O&quot;: &quot;k8s&quot;,</div><div class="line">      &quot;OU&quot;: &quot;System&quot;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<p>生成证书和公钥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cfssl gencert -ca=ca.crt -ca-key=ca.key -config=ca-config.json -profile=kubernetes wanshaoyuan-csr.json | cfssljson -bare wanshaoyuan</div></pre></td></tr></table></figure></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_2.png" alt=""></p>
<p>创建kubeconfig文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export KUBE_APISERVER=&quot;https://192.168.1.10:6443&quot;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl config set-cluster kubernetes --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --server=$&#123;KUBE_APISERVER&#125; --kubeconfig=wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl config set-credentials wanshaoyuan --client-certificate=/etc/kubernetes/pki/wanshaoyuan.pem --client-key=/etc/kubernetes/pki/wanshaoyuan-key.pem --embed-certs=true --kubeconfig=wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure>
<p>设置context<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl config set-context kubernetes --cluster=kubernetes --user=wanshaoyuan  --kubeconfig=wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>设置默认context,将集群参数和用户参数关联起来，如果配置了多个集群，可以通过集群名来切换不同的环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl config use-context kubernetes --kubeconfig=wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>查看kubectl的context<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_3.png" alt=""></p>
<p>用户目前还是kubernetes-admin，切换到wanshaoyuan<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/etc/kubernetes/pki/wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /etc/kubernetes/pki/wanshaoyuan.kubeconfig  /root/.kube/config</div></pre></td></tr></table></figure></p>
<p>再次查看<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_4.png" alt=""></p>
<p>用户目前还是kubernetes-admin，切换到wanshaoyuan<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/etc/kubernetes/pki/wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /etc/kubernetes/pki/wanshaoyuan.kubeconfig  /root/.kube/config</div></pre></td></tr></table></figure></p>
<p>再次查看<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_6.png" alt=""></p>
<p>创建角色<br>定义这个角色只能对default这个namespace 执行get、watch、list权限<br>定义角色  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">cat role.yaml</div><div class="line"></div><div class="line">kind: Role</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">metadata:</div><div class="line">  namespace: default</div><div class="line">  name: pod-reader</div><div class="line">rules:</div><div class="line">- apiGroups: [&quot;&quot;] # 空字符串&quot;&quot;表明使用core API group</div><div class="line">  resources: [&quot;pods&quot;]</div><div class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</div></pre></td></tr></table></figure>
<p>角色绑定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">cat role_bind.yaml</div><div class="line"></div><div class="line">kind: RoleBinding</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">metadata:</div><div class="line">  name: read-pods</div><div class="line">  namespace: default</div><div class="line">subjects:</div><div class="line">- kind: User</div><div class="line">  name: wanshaoyuan</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">roleRef:</div><div class="line">  kind: Role</div><div class="line">  name: pod-reader</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div></pre></td></tr></table></figure></p>
<p>应用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f role.yaml</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f role_bind.yaml</div></pre></td></tr></table></figure>
<p>check一下<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_5.png" alt=""></p>
<p>切到wanshaoyuan这个用户<br>root用户将KUBECONFIG这个变量指向刚刚创建用户出来的kubeconfig<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/root/RBAC/wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>非root用户替换默认的config文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp wanshaoyuan.kubeconfig  /root/.kube/config</div></pre></td></tr></table></figure></p>
<p>检查是否切换成功<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_6.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_7.png" alt=""></p>
<p>验证<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_8.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_9.png" alt="">  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_10.png" alt="">  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_11.png" alt="">  </p>
<p>可以看见wanshaoyuan这个用户只能访问default这个namespace的pod资源，其他的如namespace都访问不了，同样namespace的其他资源也访问不了<br>clusterrole定义的是集群级别的权限，也可以把它授予一些集群级别的资源  </p>
<p>例如<br>集群的node节点<br>非资源类型endpoint<br>跨所有命名空间的命名空间范围资源（例如pod，需要运行命令kubectl get pods –all-namespaces来查询集群中所有的pod）  </p>
<p>例如<br>定义一个clusterrole限制只能访问集群中的node节点，不能修改，其他资源都不能访问。<br>cat cluster_role.yaml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">kind: ClusterRole</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">metadata:</div><div class="line"> name: secret-reader</div><div class="line">rules:</div><div class="line">- apiGroups: [&quot;&quot;]</div><div class="line">  resources: [&quot;nodes&quot;]</div><div class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</div></pre></td></tr></table></figure></p>
<p>再定义一个ClusterRoleBinding，将上面的clusterrole和用户wanshaoyuan绑定起来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">cat cluster_role_bind.yaml</div><div class="line"></div><div class="line">kind: ClusterRoleBinding</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">metadata:</div><div class="line">  name: read-secrets-global</div><div class="line">subjects:</div><div class="line">- kind: User</div><div class="line">  name: wanshaoyuan</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">roleRef:</div><div class="line">  kind: ClusterRole</div><div class="line">  name: secret-reader</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div></pre></td></tr></table></figure></p>
<p>应用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f cluster_role.yaml</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f cluster_role_bind.yaml</div></pre></td></tr></table></figure>
<p>切换用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/root/RBAC/wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>测试<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_12.png" alt="">  </p>
<p>只能访问node，不能做其他编辑操作，集群内其他资源也访问不了。<br>例如<br>定义一个clusterrole限制只能访问集群所有namespace的cesecret，其他资源都不能访问<br>先定义一个clusterRole<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cat /root/RBAC/cluster_role.yaml  </div><div class="line">kind: ClusterRole</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">metadata:</div><div class="line"> name: secret-reader</div><div class="line">rules:</div><div class="line">- apiGroups: [&quot;&quot;]</div><div class="line">  resources: [&quot;secrets&quot;]</div><div class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</div></pre></td></tr></table></figure></p>
<p>再定义一个ClusterRoleBinding，将上面的clusterrole和用户wanshaoyuan绑定起来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">cat /root/RBAC/cluster_role_bind.yaml</div><div class="line">kind: ClusterRoleBinding</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">metadata:</div><div class="line">  name: read-secrets-global</div><div class="line">subjects:</div><div class="line">- kind: User</div><div class="line">  name: wanshaoyuan</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">roleRef:</div><div class="line">  kind: ClusterRole</div><div class="line">  name: secret-reader</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div></pre></td></tr></table></figure></p>
<p>应用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f cluster_role.yaml</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f cluster_role_bind.yaml</div></pre></td></tr></table></figure>
<p>切换用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/root/RBAC/wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<p>验证<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_13.png" alt="">  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_14.png" alt="">  </p>
<p>可以看到，wanshaoyuan这个用户，可以get集群中任意namespace的secret，但其他资源，如pod，之类的都无法查看<br>修改下，让wanshaoyuan这个帐户可以同时查看pod、secret、deployment<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/root/RBAC/wanshaoyuan.kubeconfig</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">KUBECONFIG=/etc/kubernetes/admin.conf</div></pre></td></tr></table></figure>
<p>修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">/root/RBAC/cluster_role.yaml</div><div class="line">kind: ClusterRole</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1</div><div class="line">metadata:</div><div class="line"> name: secret-reader</div><div class="line">rules:</div><div class="line">- apiGroups: [&quot;&quot;]</div><div class="line">  resources: [&quot;secrets&quot;]</div><div class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</div><div class="line"></div><div class="line">- apiGroups: [&quot;&quot;]</div><div class="line">  resources: [&quot;pod&quot;]</div><div class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</div><div class="line"></div><div class="line">- apiGroups: [&quot;extensions&quot;, &quot;apps&quot;]</div><div class="line">  resources: [&quot;deployments&quot;]</div><div class="line">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]</div></pre></td></tr></table></figure></p>
<p>用kubectl  apply去实时更新<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f cluster_role.yaml</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f cluster_role.yaml</div></pre></td></tr></table></figure>
<p>切换用户测试<br><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_15.png" alt="">  </p>
<p>pod、secret、deployment都能正常获取    </p>
<p>角色绑定包含一组相关主体即subject，subject可以是User(用户)也可以是Group(组)还可以是Service Account。<br>这里要强调下<br>Kubernetes 集群中包含两类用户：一类是由 Kubernetes 管理的 service account，另一类是普通用户。  </p>
<p>普通用户被假定为由外部独立服务管理。管理员分发私钥，用户存储（如 Keystone 或 Google 帐户），甚至包含用户名和密码列表的文件。在这方面，Kubernetes 没有代表普通用户帐户的对象。无法通过 API 调用的方式向集群中添加普通用户。  </p>
<p>相对的，service account 是由 Kubernetes API 管理的帐户。它们都绑定到了特定的 namespace，并由 API server 自动创建，或者通过 API 调用手动创建。Service account 关联了一套凭证，存储在 Secret，这些凭证同时被挂载到 pod 中，从而允许 pod 与 kubernetes API 之间的调用。  </p>
<p>API 请求被绑定到普通用户或 serivce account 上，或者作为匿名请求对待。这意味着集群内部或外部的每个进程，输入 kubectl ，都必须在向 API Server 发出请求时进行身份验证，否则被视为匿名用户。<br>来源：<a href="https://jimmysong.io/posts/user-authentication-in-kubernetes/" target="_blank" rel="external">https://jimmysong.io/posts/user-authentication-in-kubernetes/</a>  </p>
<p>kubernetes在每个namespace内都有一个默认的service account,当在创建pod或其他资源时，没有手工指定Service account时会默认使用namespace里面这个default这个Service account  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_16.png" alt="">  </p>
<p>一般来说为了安全起见，建议一个应用使用一个独立的Service account运行，这样RoleBindings就不会无意中授予其他应用程序的权限，如果需要这样使用的话在部署yaml文件中添加  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_17.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_18.png" alt=""><br>可以通过以下命令对namespace中的Service account进行默认权限配置<br>授予my-namespace命名空间内的default这个Service account帐户只读权限(view是集群中的一组通用角色，它的默认权限的是只读，它归属于clusterrole<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">kubectl create rolebinding default-view \</div><div class="line">  --clusterrole=view \</div><div class="line">  --serviceaccount=my-namespace:default \</div><div class="line">  --namespace=my-namespace</div></pre></td></tr></table></figure></p>
<p>授予my-namespace命名空间内的my-sa这个Service account帐户只读权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">kubectl create rolebinding my-sa-view \</div><div class="line">  --clusterrole=view \</div><div class="line">  --serviceaccount=my-namespace:my-sa \</div><div class="line">  --namespace=my-namespace</div></pre></td></tr></table></figure></p>
<p>授予my-namespace命名空间内所有的Service account帐户只读权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">kubectl create rolebinding serviceaccounts-view \</div><div class="line">  --clusterrole=view \</div><div class="line">  --group=system:serviceaccounts:my-namespace \</div><div class="line">  --namespace=my-namespace</div></pre></td></tr></table></figure></p>
<p>默认的Role和ClusteRrole<br>api-service会默认创建一些role和rolebinding 和clusterrole和clusterrolebind，他们默认都是以system开头的，以system开头的都是为kubernetes系统使用而保留的  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_19.png" alt="">  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_21.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_22.png" alt="">  </p>
<p>这里不多介绍主要讲讲clusterrole里面cluster-admin、admin、edit、view这几个clusterrole，直接参考<a href="https://v1-8.docs.kubernetes.io/docs/admin/authorization/rbac/" target="_blank" rel="external">https://v1-8.docs.kubernetes.io/docs/admin/authorization/rbac/</a><br>cluster-admin、admin、edit、view这几个角色是不包含system前缀的，他们是面向用户的角色，可以直接使用rolebind直接使用<br>具体权限参考下图  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/kubernetes_rbac_23.png" alt="">  </p>
<p>比如我们需要访问kubernetes-dashboard时，需要一个能够访问获取所有集群资源的用户此时就可以创建一个帐户关联cluster-admin这个角色。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">kind: ClusterRoleBinding</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">metadata:</div><div class="line"> name: admin</div><div class="line"> annotations:</div><div class="line">   rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;</div><div class="line">roleRef:</div><div class="line"> kind: ClusterRole</div><div class="line"> name: cluster-admin</div><div class="line"> apiGroup: rbac.authorization.k8s.io</div><div class="line">subjects:</div><div class="line">- kind: ServiceAccount</div><div class="line"> name: admin</div><div class="line"> namespace: kube-system</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: ServiceAccount</div><div class="line">metadata:</div><div class="line"> name: admin</div><div class="line"> namespace: kube-system</div><div class="line"> labels:</div><div class="line">   kubernetes.io/cluster-service: &quot;true&quot;</div><div class="line">   addonmanager.kubernetes.io/mode: Reconcile</div></pre></td></tr></table></figure></p>
<p>上面创建一个ServiceAccount帐户admin并将它与cluster-admin角色绑定，然后我们可以通过获取admin的token去访问dashboard。<br>kubectl -n kube-system describe secret admin-token-nwphb</p>
<p>apiGroup解释<br>上面各类角色转换中的apiGroup的解释<br>来源：<a href="https://segmentfault.com/a/1190000008700595" target="_blank" rel="external">https://segmentfault.com/a/1190000008700595</a>  </p>
<p>k8s里面有各种资源，如Pod、Service、RC、namespaces等资源，用户操作的其实也就是这一大堆资源。但这些资源并不是杂乱无章的，使用了GroupVersion的方式组织在一起。每一种资源都属于一个Group，而资源还有版本之分，如v1、v1beta1等。<br>k8s目前正在使用的API groups：  </p>
<ul>
<li>“core” group：它的REST path是api/v1  </li>
<li>“extensions” group：它的REST path是/apis/extensions/v1beta1  </li>
<li>“autoscaling”, “abac” …  </li>
</ul>
<p>k8s现阶段，API一共分为13个Group：Core、apps、authentication、authorization、autoscaling、batch、certificates、componentconfig、extensions、imagepolicy、policy、rbac、storage。其中Core的Group Name为空，它包含的API是最核心的API,如Pod、Service等。  </p>
<p>参考链接：<br><a href="http://blog.csdn.net/wangjingna/article/details/49226727" target="_blank" rel="external">http://blog.csdn.net/wangjingna/article/details/49226727</a><br><a href="http://blog.csdn.net/jettery/article/details/70138003" target="_blank" rel="external">http://blog.csdn.net/jettery/article/details/70138003</a><br><a href="http://blog.csdn.net/yan234280533/article/details/75808048" target="_blank" rel="external">http://blog.csdn.net/yan234280533/article/details/75808048</a><br><a href="http://blog.csdn.net/yan234280533/article/details/76359199" target="_blank" rel="external">http://blog.csdn.net/yan234280533/article/details/76359199</a><br><a href="http://blog.csdn.net/qqhappy8/article/details/78891200" target="_blank" rel="external">http://blog.csdn.net/qqhappy8/article/details/78891200</a><br><a href="http://www.bijishequ.com/detail/570501" target="_blank" rel="external">http://www.bijishequ.com/detail/570501</a><br><a href="http://www.sohu.com/a/205750642_610730" target="_blank" rel="external">http://www.sohu.com/a/205750642_610730</a><br><a href="https://v1-8.docs.kubernetes.io/docs/admin/authorization/rbac/" target="_blank" rel="external">https://v1-8.docs.kubernetes.io/docs/admin/authorization/rbac/</a><br><a href="https://jimmysong.io/kubernetes-handbook/" target="_blank" rel="external">https://jimmysong.io/kubernetes-handbook/</a><br><a href="https://www.cnblogs.com/charlieroro/p/8489515.html" target="_blank" rel="external">https://www.cnblogs.com/charlieroro/p/8489515.html</a></p>

      
    </div>
    <div class="article-footer">
      
    </div>
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2018/03/11/kubernetes_ingress/" title="kubernetes ingress"><i class="fa fa-angle-left" aria-hidden="true"></i>&nbsp;&nbsp;上一篇</a>
    </li>
    
    
    <li class="next">
      <a href="/2018/01/26/kubernetes_base/" title="kubernetes入门">下一篇&nbsp;&nbsp;<i class="fa fa-angle-right" aria-hidden="true"></i></a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
  </div>
  
  </div>
</nav>
  


</main>

  
  <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.js"></script>
<script src="/js/application.js"></script>
  
    
    
    
        <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>
    
    
    
        


    
    
        
    
    



</body>
</html>
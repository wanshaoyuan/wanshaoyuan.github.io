<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Linux," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="组件安装和配置zabbix本功能非常强大，自定义监控项，自动发现、自动注册等，但zabbix-server获取的zabbix数据看起来不是特别直观。
grafana的出现正好弥补了zabbix绘图能力上的不足，grafana是基于js开发的图形编辑器。telegraftelegraf是一个go语言编写的收集监控项的agentTelegraf内存占用小的特点，通过插件来实现不同的监控需求，这里我使用">
<meta property="og:type" content="article">
<meta property="og:title" content="从零开始构建云平台监控(四)图形化展示监控效果">
<meta property="og:url" content="http://yoursite.com/2017/10/13/monitor_4/index.html">
<meta property="og:site_name" content="我爱西红柿">
<meta property="og:description" content="组件安装和配置zabbix本功能非常强大，自定义监控项，自动发现、自动注册等，但zabbix-server获取的zabbix数据看起来不是特别直观。
grafana的出现正好弥补了zabbix绘图能力上的不足，grafana是基于js开发的图形编辑器。telegraftelegraf是一个go语言编写的收集监控项的agentTelegraf内存占用小的特点，通过插件来实现不同的监控需求，这里我使用">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_1.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_2.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_3.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_4.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_5.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_6.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_7.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_8.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_9.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_10.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_11.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_12.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_13.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_14.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_15.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_16.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_17.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_18.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_19.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_20.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_21.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_22.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_23.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_24.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_25.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_26.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_27.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_28.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_29.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_30.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_31.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_32.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_33.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_34.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_35.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_36.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_37.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_38.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_39.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_40.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_41.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_42.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_43.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_44.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_45.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_46.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_47.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_48.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_49.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_50.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_51.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_52.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_53.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_54.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_55.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_56.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_57.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_58.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_59.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_60.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_61.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_62.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_63.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_64.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_65.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_66.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_67.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_126.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_69.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_70.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_71.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_72.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_73.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_74.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_75.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_76.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_77.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_78.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_79.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_80.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_81.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_82.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_83.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_84.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_85.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_86.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_87.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_88.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_89.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_90.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_91.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_92.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_93.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_94.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_95.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_96.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_97.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_98.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_99.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_100.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_101.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_102.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_104.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_103.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_105.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_106.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_107.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_108.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_109.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_110.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_111.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_112.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_113.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_114.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_115.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_116.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_117.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_118.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_119.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_120.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_121.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_122.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_123.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_124.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_125.png">
<meta property="og:updated_time" content="2017-10-13T15:27:43.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="从零开始构建云平台监控(四)图形化展示监控效果">
<meta name="twitter:description" content="组件安装和配置zabbix本功能非常强大，自定义监控项，自动发现、自动注册等，但zabbix-server获取的zabbix数据看起来不是特别直观。
grafana的出现正好弥补了zabbix绘图能力上的不足，grafana是基于js开发的图形编辑器。telegraftelegraf是一个go语言编写的收集监控项的agentTelegraf内存占用小的特点，通过插件来实现不同的监控需求，这里我使用">
<meta name="twitter:image" content="http://ohx02qrb8.bkt.clouddn.com/monitor_4_1.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6229174250624779000,
      author: '我爱西红柿'
    }
  };
</script>

  <title> 从零开始构建云平台监控(四)图形化展示监控效果 | 我爱西红柿 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=59881503";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">我爱西红柿</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">已知的已知，已知的未知，未知的未知</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                从零开始构建云平台监控(四)图形化展示监控效果
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-13T23:27:44+08:00" content="2017-10-13">
              2017-10-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/10/13/monitor_4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/13/monitor_4/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="组件安装和配置"><a href="#组件安装和配置" class="headerlink" title="组件安装和配置"></a>组件安装和配置</h3><p>zabbix本功能非常强大，自定义监控项，自动发现、自动注册等，但zabbix-server获取的zabbix数据看起来不是特别直观。</p>
<p>grafana的出现正好弥补了zabbix绘图能力上的不足，grafana是基于js开发的图形编辑器。<br>telegraf<br>telegraf是一个go语言编写的收集监控项的agentTelegraf内存占用小的特点，通过插件来实现不同的监控需求，这里我使用ceph插件。</p>
<p>influxdb<br>InfluxDB 是一个开源分布式时序|、事件和指标数据库。使用 Go 语言编写，无需外部依赖。其设计目标是实现分布式和水平伸缩扩展。<br>它有三大特性：  </p>
<ol>
<li>Time Series （时间序列）：你可以使用与时间有关的相关函数（如最大，最小，求和等）  </li>
<li>Metrics（度量）：你可以实时对大量数据进行计算  </li>
<li>Eevents（事件）：它支持任意的事件数据<br>特点<br>schemaless(无结构)，可以是任意数量的列<br>Scalable<br>min, max, sum, count, mean, median 一系列函数，方便统计<br>Native HTTP API, 内置http支持，使用http读写<br>Powerful Query Language 类似sql<br>Built-in Explorer 自带管理工具  </li>
</ol>
<p>通过grafana调用zabbix的接口的实现，通过自定义模板和key去拉去数据，在grafana上进行展示，grafana只做统一的监控展示平台ceph的一些监控数据由telegraf收集存到influxdb，grafana去读取。</p>
<p>为什么选择telegraf而不直接通过zabbix写item获取这些数据？<br>1，telegraf是一个go语言写的小程序，占用资源非常小，并且本身有监控ceph的插件<br>2，telegraf监控ceph的插件，监控的数据非常全，osd数mon数，细致点，journal盘的速率、pgmap的数率，cluster的iops、pool池的使用趋势等等，如果用zabbix的话我们想获取这些数据要写非常多的item。  </p>
<h3 id="monitor-server端操作"><a href="#monitor-server端操作" class="headerlink" title="monitor-server端操作"></a>monitor-server端操作</h3><p>安装influxdb<br>influxdb的安装<br>配置yum源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/influxdb.repo</div><div class="line">[influxdb]</div><div class="line">name = InfluxDB Repository - RHEL \$releasever</div><div class="line">baseurl = https://repos.influxdata.com/rhel/\$releasever/\$basearch/stable</div><div class="line">enabled = 1</div><div class="line">gpgcheck = 1</div><div class="line">gpgkey = https://repos.influxdata.com/influxdb.key</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<p>yum install influxdb<br>systemctl enable influxdb<br>systemctl restart influxdb  </p>
<p>默认influxdb的web管理界面是关闭的开启方法<br> vim /etc/influxdb/influxdb.conf<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[admin]</div><div class="line">    enabled = true</div><div class="line">    bind-address = &quot;:8083&quot;</div></pre></td></tr></table></figure></p>
<p>重启influxdb<br>浏览器服务<a href="http://ip:8083" target="_blank" rel="external">http://ip:8083</a></p>
<h3 id="在ceph-mon节点上安装telegraf"><a href="#在ceph-mon节点上安装telegraf" class="headerlink" title="在ceph-mon节点上安装telegraf"></a>在ceph-mon节点上安装telegraf</h3><p>telegraf通过读取ceph的asok文件获取里面的信息来达到监控目的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://dl.influxdata.com/telegraf/releases/telegraf-1.2.1.x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>yum localinstall telegraf-1.2.1.x86_64.rpm</p>
<p>修改telegraf的启动用户，不然会读取ceph asok文件权限不足<br>vim /lib/systemd/system/telegraf.service<br>将User=telegraf改为User=root<br>systemctl daemon-reload<br>systemctl restart telegraf<br>systemctl enable telegraf  </p>
<p>配置telegraf<br>vim /etc/telegraf/telegraf.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[log]</div><div class="line">logfile = &quot;/var/log/telegraf/telegraf.log&quot;</div><div class="line">[[outputs.influxdb]]</div><div class="line">urls = [&quot;http://10.10.1.100:8086&quot;] # required #填写对应的influxdb的地址</div><div class="line">[[inputs.ceph]]</div><div class="line">interval = &apos;1m&apos;</div><div class="line">ceph_binary = &quot;/usr/bin/ceph&quot;</div><div class="line">socket_dir = &quot;/var/run/ceph&quot;</div><div class="line">mon_prefix = &quot;ceph-mon&quot;</div><div class="line">osd_prefix = &quot;ceph-osd&quot;</div><div class="line">ceph_user = &quot;client.admin&quot;</div><div class="line">ceph_config = &quot;/etc/ceph/ceph.conf&quot;</div><div class="line">gather_admin_socket_stats = true</div><div class="line">gather_cluster_stats = true</div></pre></td></tr></table></figure></p>
<p>另外3个控制节点同步配置<br>重启telegraf<br>测试数据是否拿到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">telegraf -test -config /etc/telegraf/telegraf.conf -config-directory /etc/telegraf/telegraf.d -input-filter ceph</div></pre></td></tr></table></figure></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_1.png" alt=""><br>在monitor-server的influxdb上可以看见创建好的库<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_2.png" alt=""></p>
<p>进入influxdb<br>influxd<br>列出全部库<br>show databases;<br>进入指定的库<br>use telegraf<br>列出库中全部表<br>show measurements;<br>查询表<br>select * from ceph;  </p>
<p>默认influxdb的数据存储时间为168小时也就是7天如果要修改方法为<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_3.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">create retention policy &quot;rp_name&quot; on &quot;db_name&quot; duration 3w replication 1 default</div><div class="line">rp_name：策略名</div><div class="line">db_name：具体的数据库名</div><div class="line">3w：保存3周，3周之前的数据将被删除，influxdb具有各种事件参数，比如：h（小时），d（天），w（星期）</div><div class="line">replication 1：副本个数，一般为1就可以了</div><div class="line">default：设置为默认策略</div></pre></td></tr></table></figure></p>
<p>对已有的策略修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter retention policy &quot;rp_name&quot; on &quot;db_name&quot; duration 30d default</div></pre></td></tr></table></figure></p>
<p>删除已有策略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop retention policy &quot;rp_name&quot;</div></pre></td></tr></table></figure></p>
<p>安装grafana<br>配置安装grafana<br>下载软件包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-4.1.2-1486989747.x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>安装软件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum localinstall /root/grafana-4.1.2-1486989747.x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>启动grafana<br>systemctl start grafana-server<br>查看端口<br>lsof -i:3000  </p>
<p>安装pie chart插件</p>
<p>ceph这一块用饼图描述比较直观点，需要安装grafana Pie Chart插件  </p>
<p>grafana-cli plugins install grafana-piechart-panel  </p>
<p>在线安装方式<br>grafana-cli plugins install grafana-piechart-panel   </p>
<p>离线安装方式<br>将下载好的plugins解压到<br>/var/lib/grafana/plugins<br>grafana-cli plugins install grafana-piechart-pane  </p>
<p>重启grafana<br>systemctl restart grafana-server<br>登录grafana<br><a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a><br>默认帐号密码为admin/admin<br>将插件激活<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_4.png" alt=""></p>
<p>enable zabbix<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_5.png" alt=""></p>
<p>右侧可以看见已经安装的插件<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_6.png" alt=""></p>
<p>添加Datasource<br>选zabbix<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_7.png" alt=""></p>
<p>url输入<br><a href="http://192.168.122.100/zabbix/api_jsonrpc.php" target="_blank" rel="external">http://192.168.122.100/zabbix/api_jsonrpc.php</a>  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_8.png" alt=""></p>
<p>测试api连接<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_9.png" alt=""></p>
<p>然后就可以在dashboard里面看见两个新模板了<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_10.png" alt=""></p>
<p>将Template Linux Server删除<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_11.png" alt=""></p>
<p>查看zabbix-server模板  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_12.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_13.png" alt=""></p>
<p>添加influxdb DataSource<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_14.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_15.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_16.png" alt=""></p>
<p>创建以下dashboard<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_17.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_18.png" alt=""></p>
<p>创建好后，我们从一个个dashboard里面添加模块</p>
<h3 id="openstack物理节点性能监控"><a href="#openstack物理节点性能监控" class="headerlink" title="openstack物理节点性能监控"></a>openstack物理节点性能监控</h3><h4 id="配置template"><a href="#配置template" class="headerlink" title="配置template"></a>配置template</h4><p>因为这是一个集群，有很多台机器，每台机器所对应的角色是不一样的，比如node-1到node-3是控制节点node-4到node6是存储节点 node-7到node-10是计算节点，不同角色的监控项也有略微不同。但我们想在一个dashboard展示多台机器的监控值<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_19.png" alt=""></p>
<p>所以我们需要定义Templating<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_20.png" alt=""></p>
<p>定义group的templating<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_21.png" alt=""></p>
<p>然后在zabbix里面定义的group就出来了<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_22.png" alt=""></p>
<p>selection options host可以选多个，然后在一个图上绘出，我建议，这里还是一一对应的显示吧<br>定义host的templating<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_23.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_24.png" alt=""></p>
<p>匹配完的显示<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_25.png" alt=""></p>
<h4 id="创建row"><a href="#创建row" class="headerlink" title="创建row"></a>创建row</h4><p>row是一组panel的集合  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_26.png" alt=""><br>这里面的uptime、memeory free、free disk space on / 、system load(1min）这些panel就是属于主机情况这个row的。<br>以创建主机情况row为例<br>dashboard下面有一个add row的按钮<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_27.png" alt=""></p>
<p>编辑row<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_28.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_29.png" alt=""></p>
<p>编辑名称显示名字<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_30.png" alt=""></p>
<p>按照上述方法创建另外3个row，资源使用情况，网卡信息，<br>然后ctrl+s保存这个dashboard的改变。<br>创建panel<br>将panel创建到对应的row中<br>创建uptime时间panel<br>点击创建panel  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_31.png" alt=""><br>类型为Singlestat panel<br>general配置 标题大小<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_32.png" alt="">   </p>
<p>metrics配置数据来源  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_33.png" alt="">   </p>
<p>配置字体颜色<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_34.png" alt="">   </p>
<p>ctrl+s保存，uptime 的panel就完成了。  </p>
<h4 id="定义memory-free-panel"><a href="#定义memory-free-panel" class="headerlink" title="定义memory free panel"></a>定义memory free panel</h4><p>在主机情况row创建Singlestat类型的panel<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_35.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_36.png" alt="">   </p>
<p>options定义背景色，和定义值范围，根据值的不同范围，背景色会自动调整</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_37.png" alt="">   </p>
<p>这里需要注意下Thresholds这个参数，这个参数定义值的范围，然后granafa会根据这个范围自动调整颜色，如7,9如果值小于7则显示红色，在7~9之间则显示橙色，大于9则显示绿色，但这个值不支持单位换算后的值，所以这也是为什么我这里是10737418240,21474836480，是10,20 G内存空闲小于10G变红色，10G~20G之间橙色，大于20G绿色。</p>
<p>ctrl+s保存  </p>
<h4 id="定义根分区剩余空间panel"><a href="#定义根分区剩余空间panel" class="headerlink" title="定义根分区剩余空间panel"></a>定义根分区剩余空间panel</h4><p>在主机情况row创建Singlestat类型的panel<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_38.png" alt="">   </p>
<p>配置metrics<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_39.png" alt="">   </p>
<p>options定义背景色，和定义值范围，根据值的不同范围，背景色会自动调整<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_40.png" alt="">   </p>
<p>这里也是定义小于10G时背景色变红，10G~20G范围内为橙色，大于20G为绿色。<br>ctrl+s保存<br>定义cpu负载panel<br>不过这里首先需要修改我们zabbix的 item，zabbix item里面定义的 per cpu而不是all cpu，所以得出来的值会比操作系统里面直接uptime看起来小 ，需要修改zabbix 里面Template OpenStack Compute、和Template OpenStack Controller里面，找到这三个健值修改成all<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_41.png" alt="">   </p>
<p>测试<br>zabbix_agentd -t “system.cpu.load[all,avg1]”  </p>
<p>在主机情况row创建Singlestat类型的panel<br>这里我选择15分钟负载情况  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_42.png" alt=""><br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_43.png" alt=""><br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_44.png" alt="">   </p>
<p>ctrl+s保存  </p>
<h4 id="定义cpu空闲率panel"><a href="#定义cpu空闲率panel" class="headerlink" title="定义cpu空闲率panel"></a>定义cpu空闲率panel</h4><p>在资源使用情况row创建Graph类型的panel<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_45.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_46.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_47.png" alt="">   </p>
<p>单位为percent</p>
<p>保存<br>ctrl+s  </p>
<h4 id="定义CPU时间片使用情况"><a href="#定义CPU时间片使用情况" class="headerlink" title="定义CPU时间片使用情况"></a>定义CPU时间片使用情况</h4><p>在资源使用情况rom创建Table panel<br>Genterl配置panel 名字<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_48.png" alt="">   </p>
<p>配置Metrics<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_49.png" alt="">   </p>
<p>配置Options<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_50.png" alt="">   </p>
<p>ctrl+s保存</p>
<h4 id="定义可用内存panel"><a href="#定义可用内存panel" class="headerlink" title="定义可用内存panel"></a>定义可用内存panel</h4><p>在资源使用情况rom创建Graph panel<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_51.png" alt=""><br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_52.png" alt=""><br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_53.png" alt="">   </p>
<h4 id="定义网桥流量监控panel"><a href="#定义网桥流量监控panel" class="headerlink" title="定义网桥流量监控panel"></a>定义网桥流量监控panel</h4><p>这里需要注意，我们直接对ovs桥进行监控，因为通过ovs桥我们可以确认这部分流量的用途，直接通过物理网卡的话不直观，所以这里需要在zabbix里面将对应的item加上。  </p>
<p>这里将Incoming和Outcoming拆分了开来用两张图显示，并且只监控traffic流量。<br>在网卡信息row创建Graph panel<br>先配置Incoming_Network_traffic</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_54.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_55.png" alt="">   </p>
<p><code>注意item为&quot;/Incoming network traffic on br-.*/&quot;</code><br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_56.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_57.png" alt="">   </p>
<p>在配置Outcoming_Network_traffic<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_58.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_59.png" alt="">   </p>
<p>item写这个   </p>
<p><code>/Outgoing network traffic on br-.*/</code><br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_60.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_61.png" alt="">   </p>
<p>ctrl+s  </p>
<p>最终效果<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_62.png" alt="">   </p>
<h3 id="添服务状态dashboard，"><a href="#添服务状态dashboard，" class="headerlink" title="添服务状态dashboard，"></a>添服务状态dashboard，</h3><p>这里我拆分为3个dashboard，分别是OpenStack控制节点服务状态、OpenStack计算节点服务状态、OpenStack储存节点服务状态  </p>
<p>每个dashboard设置不同的Templating以OpenStack控制节点服务状态为例，后面都一样<br>创建group，指定为controller这样就不会选别的了，计算节点就指定为computer、储存节点就指定为ceph  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_63.png" alt="">   </p>
<p>创建host<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_64.png" alt="">   </p>
<p>ctrl+s保存  </p>
<h3 id="OpenStack控制节点服务状态"><a href="#OpenStack控制节点服务状态" class="headerlink" title="OpenStack控制节点服务状态"></a>OpenStack控制节点服务状态</h3><h4 id="定义nova-api-panel"><a href="#定义nova-api-panel" class="headerlink" title="定义nova-api panel"></a>定义nova-api panel</h4><p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_65.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_66.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_67.png" alt=""><br>配置 value mapping，因为默认抓取的值为数字我们需要将数字映射为更好看的值，比如大于1映射为running，其他映射为down，这里测试发现down后值经常为0.0x所以这里设置映射为值的范围，比如0~0.9为down，1为up  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_126.png" alt=""></p>
<p>效果如下<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_69.png" alt=""><br>我把nova-api关掉  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_70.png" alt="">   </p>
<p>其他控制节点和计算节点监控项目可以直接duplicate了，只需要修改下panel和metrics<br>控制节点需要显示的panel<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">nova-api</div><div class="line">nova-scheduler</div><div class="line">nova-conductor</div><div class="line">Neutron-server</div><div class="line">Neutron-l3-agent</div><div class="line">Neutron-ovs-agent</div><div class="line">Neutron-metadata</div><div class="line">Neutron-DHCP</div><div class="line">Glance-api</div><div class="line">Glance-Registry</div><div class="line">Keystone</div><div class="line">Rabbitmq_cluster</div><div class="line">Rabbitmq_liste_port</div><div class="line">Rabbitmq_BEAM_process</div><div class="line">Rabbitmq_EPMD_listen_port</div><div class="line">Rabbitmq_EPMD_process</div><div class="line">Mysql_cluster</div><div class="line">Cinder_api</div><div class="line">Cinder_scheduler</div><div class="line">Cinder_volumer</div><div class="line">Ceilometer_process</div><div class="line">Ceilometer_API</div></pre></td></tr></table></figure></p>
<p>计算节点需要显示的panel<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">openstack-compute</div><div class="line">libvirtd</div><div class="line">openvswitch-agent</div><div class="line">ceilometer-agent-compute</div></pre></td></tr></table></figure></p>
<h3 id="zabbix-altert-dashboard"><a href="#zabbix-altert-dashboard" class="headerlink" title="zabbix-altert dashboard"></a>zabbix-altert dashboard</h3><p>alter-dashboard主要显示整个集群的问题  </p>
<p>创件panel，类型为zabbix-Triggers<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_71.png" alt="">   </p>
<p>添加后，它自动会将zabbix的Triggers同步过来<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_72.png" alt="">   </p>
<h3 id="ceph-dashboard"><a href="#ceph-dashboard" class="headerlink" title="ceph dashboard"></a>ceph dashboard</h3><h4 id="创建template"><a href="#创建template" class="headerlink" title="创建template"></a>创建template</h4><p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_73.png" alt="">   </p>
<p>这里需要注意把group中固定住控制节点  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_74.png" alt="">   </p>
<p>host配置<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_75.png" alt="">   </p>
<h4 id="添加ceph健康状态监控panel"><a href="#添加ceph健康状态监控panel" class="headerlink" title="添加ceph健康状态监控panel"></a>添加ceph健康状态监控panel</h4><p>在状态row中创建 Singlestat  panel  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_76.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_77.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_78.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_79.png" alt="">   </p>
<h4 id="添加ceph-mon总数监控panel"><a href="#添加ceph-mon总数监控panel" class="headerlink" title="添加ceph mon总数监控panel"></a>添加ceph mon总数监控panel</h4><p>在状态row中创建一个singlestat的panel，General修改名字，metrics配置数据源<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_80.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_81.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_82.png" alt="">   </p>
<h4 id="添加ceph-mon-up数panel"><a href="#添加ceph-mon-up数panel" class="headerlink" title="添加ceph mon up数panel"></a>添加ceph mon up数panel</h4><p>在状态row中创建一个singlestat的panel，General修改名字，metrics配置数据源<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_83.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_84.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_85.png" alt="">   </p>
<p>thresholds要根据实际集群mon数写，ceph-mon不能挂掉总个数的一半，3个mon只能挂1个，所以这里写2,3小于2时就变红。</p>
<h4 id="添加ceph-osd总数监控panel"><a href="#添加ceph-osd总数监控panel" class="headerlink" title="添加ceph osd总数监控panel"></a>添加ceph osd总数监控panel</h4><p>在状态row中创建一个singlestat的panel，General修改名字，metrics配置数据源  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_86.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_87.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_88.png" alt="">   </p>
<h4 id="添加ceph-osd-up数监控panel"><a href="#添加ceph-osd-up数监控panel" class="headerlink" title="添加ceph osd up数监控panel"></a>添加ceph osd up数监控panel</h4><p>在状态row中创建一个singlestat的panel，General修改名字，metrics配置数据源</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_89.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_90.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_91.png" alt="">   </p>
<h4 id="添加ceph总容量panel"><a href="#添加ceph总容量panel" class="headerlink" title="添加ceph总容量panel"></a>添加ceph总容量panel</h4><p>在容量row中创建一个singlestat的panel，General修改名字，metrics配置数据源<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_92.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_93.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_94.png" alt="">   </p>
<p>注意单位</p>
<h4 id="添加ceph剩余容量panel"><a href="#添加ceph剩余容量panel" class="headerlink" title="添加ceph剩余容量panel"></a>添加ceph剩余容量panel</h4><p>在容量row中创建一个singlestat的panel，General修改名字，metrics配置数据源<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_95.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_96.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_97.png" alt="">   </p>
<h4 id="添加ceph已用容量panel"><a href="#添加ceph已用容量panel" class="headerlink" title="添加ceph已用容量panel"></a>添加ceph已用容量panel</h4><p>在容量row中创建一个singlestat的panel，General修改名字，metrics配置数据源</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_98.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_99.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_100.png" alt="">   </p>
<p>注意单位</p>
<h4 id="添加ceph容量使用率-饼图-panel"><a href="#添加ceph容量使用率-饼图-panel" class="headerlink" title="添加ceph容量使用率(饼图)panel"></a>添加ceph容量使用率(饼图)panel</h4><p>在容量row中创建一个 Pie Chart 的panel，General修改名字，metrics配置数据源<br>已经使用和剩余可用百分比<br>利用饼图展示已用空间占总空间的比例<br>新建个panel，类型选择pie chart<br>general设置名字  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_101.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_102.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_104.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_103.png" alt="">   </p>
<h4 id="添加pool容量使用率-已compute-pool为例-panel"><a href="#添加pool容量使用率-已compute-pool为例-panel" class="headerlink" title="添加pool容量使用率(已compute pool为例)panel"></a>添加pool容量使用率(已compute pool为例)panel</h4><p>在容量row中创建一个 Pie Chart 的panel，General修改名字，metrics配置数据源  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_105.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_106.png" alt="">   </p>
<p>option这里根刚才一样<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_107.png" alt="">   </p>
<p>另外几个pool根这个一样，需要注意的是 where name里面的pool name要更改。</p>
<h4 id="添加pool池的使用趋势图-以compute-pool为例-panel"><a href="#添加pool池的使用趋势图-以compute-pool为例-panel" class="headerlink" title="添加pool池的使用趋势图(以compute pool为例)panel"></a>添加pool池的使用趋势图(以compute pool为例)panel</h4><p>在pool池中的使用情况row中创建Graph panel</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_108.png" alt="">  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_109.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_110.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_111.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_112.png" alt="">   </p>
<p>显示30天的数据<br>剩下pool的使用情况图根上面有一，只需要修改metrics里面的pool名就可以了  </p>
<h4 id="添加性能panel"><a href="#添加性能panel" class="headerlink" title="添加性能panel"></a>添加性能panel</h4><p>在性能row中创将graph panel  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_113.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_114.png" alt="">   </p>
<p>注意这里的datasource是 zabbix  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_115.png" alt="">   </p>
<p>单位选择IOPS</p>
<h4 id="添加ceph-pg-read-rate-panel"><a href="#添加ceph-pg-read-rate-panel" class="headerlink" title="添加ceph pg read rate panel"></a>添加ceph pg read rate panel</h4><p>在性能row中创将graph panel<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_116.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_117.png" alt="">   </p>
<p>单位为bites<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_118.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_119.png" alt="">   </p>
<p>显示一天的</p>
<h4 id="添加ceph-pg-write-rate-panel"><a href="#添加ceph-pg-write-rate-panel" class="headerlink" title="添加ceph pg write rate panel"></a>添加ceph pg write rate panel</h4><p>在性能row中创将graph panel<br><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_120.png" alt="">   </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_121.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_122.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_123.png" alt="">   </p>
<p>最终效果  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_124.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/monitor_4_125.png" alt="">   </p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/weixin.png" alt="我爱西红柿 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag">#Linux</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/11/monitor_3/" rel="next" title="从零开始构建云平台监控(三)配置基础监控平台">
                <i class="fa fa-chevron-left"></i> 从零开始构建云平台监控(三)配置基础监控平台
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/16/monitor_5/" rel="prev" title="从零开始搭建云平台监控(五)监控自动化部署">
                从零开始搭建云平台监控(五)监控自动化部署 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/10/13/monitor_4/"
           data-title="从零开始构建云平台监控(四)图形化展示监控效果" data-url="http://yoursite.com/2017/10/13/monitor_4/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/image.png"
               alt="我爱西红柿" />
          <p class="site-author-name" itemprop="name">我爱西红柿</p>
          <p class="site-description motion-element" itemprop="description">好好学习、天天向上</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wanshaoyuan" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/wanshaoyuan" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#组件安装和配置"><span class="nav-number">1.</span> <span class="nav-text">组件安装和配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#monitor-server端操作"><span class="nav-number">2.</span> <span class="nav-text">monitor-server端操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在ceph-mon节点上安装telegraf"><span class="nav-number">3.</span> <span class="nav-text">在ceph-mon节点上安装telegraf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#openstack物理节点性能监控"><span class="nav-number">4.</span> <span class="nav-text">openstack物理节点性能监控</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置template"><span class="nav-number">4.1.</span> <span class="nav-text">配置template</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建row"><span class="nav-number">4.2.</span> <span class="nav-text">创建row</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义memory-free-panel"><span class="nav-number">4.3.</span> <span class="nav-text">定义memory free panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义根分区剩余空间panel"><span class="nav-number">4.4.</span> <span class="nav-text">定义根分区剩余空间panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义cpu空闲率panel"><span class="nav-number">4.5.</span> <span class="nav-text">定义cpu空闲率panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义CPU时间片使用情况"><span class="nav-number">4.6.</span> <span class="nav-text">定义CPU时间片使用情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义可用内存panel"><span class="nav-number">4.7.</span> <span class="nav-text">定义可用内存panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义网桥流量监控panel"><span class="nav-number">4.8.</span> <span class="nav-text">定义网桥流量监控panel</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添服务状态dashboard，"><span class="nav-number">5.</span> <span class="nav-text">添服务状态dashboard，</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenStack控制节点服务状态"><span class="nav-number">6.</span> <span class="nav-text">OpenStack控制节点服务状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义nova-api-panel"><span class="nav-number">6.1.</span> <span class="nav-text">定义nova-api panel</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zabbix-altert-dashboard"><span class="nav-number">7.</span> <span class="nav-text">zabbix-altert dashboard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ceph-dashboard"><span class="nav-number">8.</span> <span class="nav-text">ceph dashboard</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建template"><span class="nav-number">8.1.</span> <span class="nav-text">创建template</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph健康状态监控panel"><span class="nav-number">8.2.</span> <span class="nav-text">添加ceph健康状态监控panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph-mon总数监控panel"><span class="nav-number">8.3.</span> <span class="nav-text">添加ceph mon总数监控panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph-mon-up数panel"><span class="nav-number">8.4.</span> <span class="nav-text">添加ceph mon up数panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph-osd总数监控panel"><span class="nav-number">8.5.</span> <span class="nav-text">添加ceph osd总数监控panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph-osd-up数监控panel"><span class="nav-number">8.6.</span> <span class="nav-text">添加ceph osd up数监控panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph总容量panel"><span class="nav-number">8.7.</span> <span class="nav-text">添加ceph总容量panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph剩余容量panel"><span class="nav-number">8.8.</span> <span class="nav-text">添加ceph剩余容量panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph已用容量panel"><span class="nav-number">8.9.</span> <span class="nav-text">添加ceph已用容量panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph容量使用率-饼图-panel"><span class="nav-number">8.10.</span> <span class="nav-text">添加ceph容量使用率(饼图)panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加pool容量使用率-已compute-pool为例-panel"><span class="nav-number">8.11.</span> <span class="nav-text">添加pool容量使用率(已compute pool为例)panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加pool池的使用趋势图-以compute-pool为例-panel"><span class="nav-number">8.12.</span> <span class="nav-text">添加pool池的使用趋势图(以compute pool为例)panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加性能panel"><span class="nav-number">8.13.</span> <span class="nav-text">添加性能panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph-pg-read-rate-panel"><span class="nav-number">8.14.</span> <span class="nav-text">添加ceph pg read rate panel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加ceph-pg-write-rate-panel"><span class="nav-number">8.15.</span> <span class="nav-text">添加ceph pg write rate panel</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">我爱西红柿</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"bladen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>

<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>Docker基础 | 我爱西红柿</title>
  <meta name="description" content="此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。基础容器不关有docker还有core os的rkt、
容器runtime是真正运行容器的地方，runtime需要跟操作系统kernel紧密协作，为容器提供运行环境，docker曾经的runtime是linux上的lxc，后面docker自己开发了runc，目前runc是docker默认的runtime
rkt是coreos开">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker基础">
<meta property="og:url" content="http://yoursite.com/2017/10/30/docker_base/index.html">
<meta property="og:site_name" content="我爱西红柿">
<meta property="og:description" content="此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。基础容器不关有docker还有core os的rkt、
容器runtime是真正运行容器的地方，runtime需要跟操作系统kernel紧密协作，为容器提供运行环境，docker曾经的runtime是linux上的lxc，后面docker自己开发了runc，目前runc是docker默认的runtime
rkt是coreos开">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_1.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_2.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_3.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_4.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_5.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_6.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_7.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_8.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_9.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_10.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_11.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_12.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_13.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_14.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_32.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_15.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_16.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_33.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_17.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_18.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_34.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_19.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_20.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_21.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_22.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_23.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_24.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_25.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_35.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_26.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_27.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_28.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_29.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_30.png">
<meta property="og:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_31.png">
<meta property="og:updated_time" content="2017-10-30T13:45:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker基础">
<meta name="twitter:description" content="此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。基础容器不关有docker还有core os的rkt、
容器runtime是真正运行容器的地方，runtime需要跟操作系统kernel紧密协作，为容器提供运行环境，docker曾经的runtime是linux上的lxc，后面docker自己开发了runc，目前runc是docker默认的runtime
rkt是coreos开">
<meta name="twitter:image" content="http://ohx02qrb8.bkt.clouddn.com/docker_base_1.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://yoursite.com/2017/10/30/docker_base/index.html">
  
    <link rel="alternate" href="/atom.xml" title="我爱西红柿" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  <!-- font-awesome CSS -->
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
    
    

</head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/wanshaoyuan" target="_blank">
          <img class="img-circle img-rotate" src="/images/image.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">我爱西红柿</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">OpenStack engineer &amp;&amp; devops</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="fa fa-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="fa fa-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      <!-- <span class="ins-close ins-selectable"><i class="fa fa-times"></i></span> -->
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav">
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="fa fa-fw fa-dashboard"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="fa fa-fw fa-delicious"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="fa fa-fw fa-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="fa fa-fw fa-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="fa fa-fw fa-gg"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="fa fa-fw fa-coffee"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/wanshaoyuan" target="_blank" title="Github" ><i class="fa fa-github"></i></a></li>
        
        <li><a href="http://www.bldewan.com" target="_blank" title="Behance" ><i class="fa fa-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" ><i class="fa fa-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            
            <div class="content">
                <p>已知的已知，已知的未知，未知的未知</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ceph/">ceph</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/neutron/">neutron</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/openstack/">openstack</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ceph/">ceph</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/neutron/">neutron</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/">openstack</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/操作系统/">操作系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Linux/" style="font-size: 13.8px;">Linux</a> <a href="/tags/Python/" style="font-size: 13.2px;">Python</a> <a href="/tags/ceph/" style="font-size: 13.4px;">ceph</a> <a href="/tags/docker/" style="font-size: 14px;">docker</a> <a href="/tags/neutron/" style="font-size: 13.6px;">neutron</a> <a href="/tags/openstack/" style="font-size: 13.8px;">openstack</a> <a href="/tags/安全/" style="font-size: 13px;">安全</a> <a href="/tags/操作系统/" style="font-size: 13px;">操作系统</a> <a href="/tags/数据库/" style="font-size: 13.2px;">数据库</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/docker/">docker</a>
              </p>
              <p class="item-title">
                <a href="/2017/12/15/docker_weave/" class="title">Docker多主机网络(weave)</a>
              </p>
              <p class="item-date">
                <time datetime="2017-12-15T13:45:59.000Z" itemprop="datePublished">2017-12-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/docker/">docker</a>
              </p>
              <p class="item-title">
                <a href="/2017/12/14/docker_flannel/" class="title">Docker多主机网络(flannel)</a>
              </p>
              <p class="item-date">
                <time datetime="2017-12-14T13:45:59.000Z" itemprop="datePublished">2017-12-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/docker/">docker</a>
              </p>
              <p class="item-title">
                <a href="/2017/12/07/docker_macvlan/" class="title">Docker多主机网络(macvlan)</a>
              </p>
              <p class="item-date">
                <time datetime="2017-12-07T13:45:59.000Z" itemprop="datePublished">2017-12-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/docker/">docker</a>
              </p>
              <p class="item-title">
                <a href="/2017/12/05/docker_compose/" class="title">docker-compose</a>
              </p>
              <p class="item-date">
                <time datetime="2017-12-05T13:45:59.000Z" itemprop="datePublished">2017-12-05</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/docker/">docker</a>
              </p>
              <p class="item-title">
                <a href="/2017/12/04/docker_habor/" class="title">docker镜像仓库管理软件(habor）</a>
              </p>
              <p class="item-date">
                <time datetime="2017-12-04T13:45:59.000Z" itemprop="datePublished">2017-12-04</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。"><span class="toc-number">1.</span> <span class="toc-text">此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础"><span class="toc-number">1.1.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker镜像"><span class="toc-number">1.2.</span> <span class="toc-text">docker镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#容器资源的限制"><span class="toc-number">1.3.</span> <span class="toc-text">容器资源的限制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cpu限额"><span class="toc-number">1.3.1.</span> <span class="toc-text">cpu限额</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#block-io限制"><span class="toc-number">1.3.2.</span> <span class="toc-text">block io限制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现容器的底层技术"><span class="toc-number">1.4.</span> <span class="toc-text">实现容器的底层技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker存储"><span class="toc-number">1.5.</span> <span class="toc-text">docker存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bind-mount"><span class="toc-number">1.5.1.</span> <span class="toc-text">bind mount</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-manged-volume"><span class="toc-number">1.5.2.</span> <span class="toc-text">docker manged volume</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据共享"><span class="toc-number">1.5.3.</span> <span class="toc-text">数据共享</span></a></li></ol></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-docker_base" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Docker基础
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="fa fa-calendar-check-o"></i>
	<a href="/2017/10/30/docker_base/" class="article-date">
	  <time datetime="2017-10-30T13:45:59.000Z" itemprop="datePublished">2017-10-30</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/docker/">docker</a>
  </span>

        
  <span class="article-tag">
    <i class="fa fa-tag"></i>
	<a class="article-tag-link" href="/tags/docker/">docker</a>
  </span>


        

        <span class="post-comment"><i class="fa fa-commenting-o"></i> <a href="/2017/10/30/docker_base/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 4,101(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 16(分)</span>
	

      </div>
      
      <div class="toggle-toc hidden-xs" data-stick-top>
        <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
          <i class="text-collapsed fa fa-anchor"></i>
          <i class="text-in fa fa-close"></i>
        </a>
      </div>
      
    </div>
    <div class="article-entry markdown-body" itemprop="articleBody">
      
        <h2 id="此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。"><a href="#此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。" class="headerlink" title="此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。"></a>此文档为翻阅cloudman的每天5分钟玩转docker技术的读书笔记。</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>容器不关有docker还有core os的rkt、</p>
<p>容器runtime是真正运行容器的地方，runtime需要跟操作系统kernel紧密协作，为容器提供运行环境<br>，docker曾经的runtime是linux上的lxc，后面docker自己开发了runc，目前runc是docker默认的runtime</p>
<p>rkt是coreos开发的容器runtime.</p>
<p>容器管理工具<br>lxd是lxc对应的管理工具<br>runc的管理工具是docker engine，docker engine包含daemon和cli两个部分<br>rkt的管理工具rkt cli  </p>
<p>容器定义工具<br>docker image是docker容器的模板,runtime依据docker image创建容器<br>docker file是包含若干命令的文本文件，可以通过这些命令创建出docker image  aci与docker image类似，它是coreos开发的rkt容器image格式。</p>
<p>容器仓库<br>私有仓库：registry</p>
<p>公共仓库：docker hub，Quay.io</p>
<p>容器os<br>coreos 、atomic、ubuntu core</p>
<p>容器平台技术  </p>
<p>容器编排引擎:docker swarm、kubernetes、mesos+mariathon</p>
<p>容器管理平台：rancher、containership、</p>
<p>基于容器的pass：deis、flynn、dokku</p>
<p>容器支持技术<br>容器网络:docker network、flannel、weave、calico<br>服务发现：etcd、consul、zookeeper<br>数据管理：rex-ray<br>日志管理：docker logs、logspout<br>安全性：openscap  </p>
<h3 id="docker镜像"><a href="#docker镜像" class="headerlink" title="docker镜像"></a>docker镜像</h3><p>linux发行版都是由内核空间和用户空间组成，内核空间是kernel，用户空间的文件系统是rootfs，可以简单的说不同linux发行版的主要区别都是rootfs</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_1.png" alt=""></p>
<p>base镜像：1，不依赖其他镜像，其他应用镜像可以在base镜像的基础上进行扩展，base镜像通常是各linux发行版的docker镜像，如centos、ubuntu、Debian，大部分应用镜像都是在base镜像的基础上进行扩展的。</p>
<p>下载镜像<br>docker pull centos</p>
<p>查看镜像<br>docker images centos</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_2.png" alt=""></p>
<p>正如上面所说base镜像这么小，因为base镜像只有一个rootfs，kernel它是和宿主机共享的，base镜像只是在用户空间和发行版是一致的，内核版本是共享宿主机的kernel的，ubuntu14.04 kernel版本是4.x，但centos7.3kernel版本是3.10，当在ubuntu14.04上跑centos7.3的docker镜像时，centos7.3的内核版本也会变成4.x因为它是共享宿主机内核。  </p>
<p>容器只能使用宿主机kernel，不能更改，不能升级，如果应用要求高内核，建议使用虚拟机。</p>
<p>docker镜像采用分层的结构。基于docker file文件，你每做的操作其实都是在base镜像上加一层，每安装一个软件就是在现有镜像基础上增加一层，这样做的好处时，一个共享资源</p>
<p>比如：有多个镜像都从相同的base镜像构建出来，那宿主机只需要一个base_image,多个镜像共享一个base镜像当某个容器镜像修改基础镜像内容时，会将基础镜像的内容像copy一份到应用镜像内，然后在修改应用镜像内的数据，这根前面说的ceph的快照和clone是一样的，都是使用的cow(copy on write)技术</p>
<p>当容器启动时，会有一层可写层在容器顶部叫容器层，所有对容器的改动，无论添加、删除，修改文件都会发生的容器层中，容器层下面是镜像层，镜像层是只读的。</p>
<p>构建镜像<br>docker commit</p>
<p>在对原镜像做修改后使用docker commit将生成一个新镜像。<br>docker commit 原镜像名 新镜像名</p>
<p>Dockerfile</p>
<p>Dockerfile是一个文本文件记录镜像构件的步骤</p>
<p>如Dockerfile为<br>FROM centos<br>RUN yum install vim -y</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_3.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_4.png" alt=""></p>
<p>docker build<br>-t 为新镜像名字<br>.为指定当前目录为build context，docker 会从build   context中寻找Dockerfile<br>-f可以手动指定Dockerfile的文件  </p>
<p>如果Dockerfile不在本地<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_5.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_6.png" alt=""></p>
<p>可以看见启动一个3d799f4的临时容器，然后在临时容器中安装vim，安装成功后将临时容器保存为镜像，最后删除临时容器。</p>
<p>查看容器分层</p>
<p>docker history 镜像名</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_7.png" alt=""></p>
<p>镜像的缓存特性  </p>
<p>docker会缓存已有的镜像的镜像层，如果镜像存在就直接使用，不用创建，如果不希望使用缓存镜像则在docker build时加上–no-cache参数</p>
<p>docker镜像的上层是依赖下层的，只要下层发生变化，上层也会根着变。</p>
<p>如果在build某一步中出错了,可以通过docker run -it 先进上一步生成临时镜像进行调试。</p>
<p>搭建docker私有镜像仓库  </p>
<p>从docker hub上下载registryv2.3.1的私有仓库镜像<br>docker pull registry:2.3.1</p>
<p>使用htpasswd配置docker私有仓库验证<br>[root@wan_test /]# mkdir /root/auth/</p>
<p>生成验证admin：admin为用户名和密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --entrypoint htpasswd registry:2.3.1 -Bbn admin admin &gt; /root/auth/htpasswd</div></pre></td></tr></table></figure></p>
<p>启动私有仓库容器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d  -p 5000:5000 -v /myregistry/:/var/lib/registry -v /root/auth/:/auth -e &quot;REGISTRY_AUTH=htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd registry:2.3.1</div></pre></td></tr></table></figure></p>
<p>测试登录<br>先用个错误的帐号密码测试<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_8.png" alt=""></p>
<p>在用对的  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_9.png" alt=""></p>
<p>认证以后无法直接在服务器查看<br><code>curl 127.0.0.1:5000/v2/_catalog</code> 仓库的镜像，会出现报错，但是可以用浏览器输入帐号密码访问。</p>
<p>测试上传镜像<br>命名要规范格式为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[registry_host]:[port]/[username]/[封装的应用]:[版本]</div><div class="line"></div><div class="line">docker tag hello-world 10.211.55.5:5000/wan/hello-wolrd:v1</div></pre></td></tr></table></figure></p>
<p>docker push上传镜像<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_10.png" alt=""></p>
<p>默认client是打开ssl的，但Server端没有配置证书，所以先关闭<br>/usr/lib/systemd/system/docker.service</p>
<p>关闭ssl安全认证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecStart=/usr/bin/dockerd --insecure-registry 10.211.55.5:5000</div></pre></td></tr></table></figure></p>
<p>systemctl restart docker</p>
<p>测试下载<br>将本地10.211.55.5:5000/wan/hello-wolrd:v1删除</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_11.png" alt=""></p>
<p>重新从服务器上pull下来  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_12.png" alt=""></p>
<p>查看镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://10.211.55.5:5000/v2/_catalog</div></pre></td></tr></table></figure></p>
<p>web页面版的私有镜像管理软件<br>Portus<br>harbor<br><a href="https://www.linuxea.com/1557.html" target="_blank" rel="external">https://www.linuxea.com/1557.html</a></p>
<p>两种进入容器的方法<br>docker attach image_id<br>docker exec -it image_id<br>区别是，attach进去的还是之前的终端，不会启用新的终端，exec进去是启动一个新的终端。  </p>
<p>运行容器的最佳实践<br>服务类型的容器通过-d以后台的方式启动这类容器</p>
<p>工具类型的直接docker run -it的方式，用完就exit掉</p>
<p>容器的操作  </p>
<p>容器在docker host中实际就是一个进程，docker stop命令实际就是向中国进程发送一个SIGKILL信号</p>
<p>docker run –restart=always 表示无论容器因何种原因退出（含正常退出)都立刻重启，–restart=on-failure:3意思是如果启动进程退出代码非0，则重启容器，最多重启3次。</p>
<p>pause/unpause 挂起容器/解除挂起</p>
<p>查看所有exited状态的容器<br>docker ps -aq -f status=exited</p>
<h3 id="容器资源的限制"><a href="#容器资源的限制" class="headerlink" title="容器资源的限制"></a>容器资源的限制</h3><p>docker run时指定<br>-m或–memory 设置内存的使用限额<br>–memory-swap设置内存+swap的使用限额。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -m 200M --memory-swap=300M centos</div></pre></td></tr></table></figure></p>
<p>其含义是该容器最多使用200M内存和100M swap，因为–memory-swap是memory+swap所以前面指定的-m后面swap等于300-200， 默认情况下这两组参数都是-1，不是不限制。<br>只指定定了-m没指定–memory-swap时默认–memory-swap是-m的两倍。</p>
<p>使用progrium/stress镜像测试，只要线分配给线程的内存大小在可分配范围(300M）内，镜像就会一直工作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it -m 200M --memory-swap=300M progrium/stress --vm 1 --vm-bytes 180M</div></pre></td></tr></table></figure></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_13.png" alt=""></p>
<p>如果超过了，容器马上回报错退出<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_14.png" alt=""></p>
<h4 id="cpu限额"><a href="#cpu限额" class="headerlink" title="cpu限额"></a>cpu限额</h4><p>cpu限额限制的不是实际cpu的使用量，资源的优先级，也就是，在cpu资源紧张时，优先级高的获的的cpu时间片要长一些  </p>
<p>docker cpu限制参数<br>–cpuset-cpus=””    允许使用的 CPU 集，值可以为 0-3,0,1<br>-c,–cpu-shares=0    CPU 共享权值（相对权重）<br>cpu-period=0    限制 CPU CFS 的周期，范围从 100ms~1s，即[1000, 1000000]<br>–cpu-quota=0    限制 CPU CFS 配额，必须不小于1ms，即 &gt;= 1000<br>–cpuset-mems=””    允许在上执行的内存节点（MEMs），只对 NUMA 系统有效  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_32.png" alt=""></p>
<p>cpu-shares<br>通过–cpu-shares设置容器cpu配额，默认为一个core为1024，二个为2048，依次类推，设置为0，系统将会按默认值配置，假定一个1core的运行3个container，其中一个cpu-shares为1024，另外两个为512则，当cpu忙碌时，1024的占用50%cpu时间，512的分别占用25%，当增加一个1024的contain时，占用比为1024+1024+512+512 =3072 每个container占用cpu时间比为 1024/3072=33%  1024/3072=33% 512/3027=17% 512/3072=17%</p>
<p>比如在host上启用两个容器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --name container_a -it --cpu-shares 2048 progrium/stress --cpu 2</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --name container_b -it --cpu-shares 1024 progrium/stress --cpu 2</div></pre></td></tr></table></figure>
<p>–cpu 有多少核，就写多少  ，这里设置为2<br>可以看见container_a的cpu资源消耗是container_b的两倍</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_15.png" alt=""></p>
<p>paush container_a,此时container_b又会将cpu整格cpu占满</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_16.png" alt=""></p>
<h4 id="block-io限制"><a href="#block-io限制" class="headerlink" title="block io限制"></a>block io限制</h4><p>block io是用来限制容器的磁盘的读写，针对bps（每秒读写的数据量)和iops(每秒IO的次数),控制容器的读写磁盘的带宽。</p>
<p>限制block io的参数  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_33.png" alt=""></p>
<p>目前block io限额只对dicectIO（不使用文件缓存)有效。</p>
<p>测试<br>先在容器内使用dd测试bps</p>
<p>run一个centos的镜像</p>
<p>docker run -itd centos  </p>
<p>限制前<br>进入centos镜像<br>docker exec -it 15643e5ec7d9 /bin/bash  </p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_17.png" alt=""></p>
<p>限制io为30M后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -itd --device-write-bps /dev/sda:300MB centos</div></pre></td></tr></table></figure></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_18.png" alt=""></p>
<h3 id="实现容器的底层技术"><a href="#实现容器的底层技术" class="headerlink" title="实现容器的底层技术"></a>实现容器的底层技术</h3><p>曾经docker的runtime是linux内核自带的lxc，后面docker重新开发了自己的runtime，runc，目前docker通过cgroup实现资源限制，如上面的限制cpu资源、限制memory资源、限制blockIO资源大都是通过linux底层的cgroup实现，namespace实现资源隔离，每个容器独立的文件系统，网卡资源等是通过linux底层的namespace，openstack neutron的 多租户隔离qroute和qdhcp也是通过namespace去实现的。</p>
<p>linux下6种namespace资源</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_34.png" alt=""></p>
<h3 id="docker存储"><a href="#docker存储" class="headerlink" title="docker存储"></a>docker存储</h3><p>容器镜像的分层结构<br>容器镜像<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_19.png" alt=""></p>
<p>1、镜像由一个base镜像+若干个只读镜像+一个可写的容器层，这种分层架构最大的特性建设copy-on-write。<br>2、对数据的修改都是在容器层完成的，新修改的数据都会放在最上层容器层。<br>3、修改数据时，如果容器层没有，会先从其他层将数据copy到容器层，然后在修改。此时镜像层数据保持不变。<br>4、如果有多个层有命名相同的文件，用户只能看见最上层中的文件。  </p>
<p>分层结构是由linux store driver提供，docker支持多种storage driver 如 AUFS、Device Mapper、Btrfs、OverlayFs、VFS、ZFS，ubuntu默认是AUFS、centos7默认是OverlayFs ， docker默认使用linux 发行版的storage driver  </p>
<p>docker info可以看见<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_20.png" alt=""></p>
<p>有些容器创建和销毁，不依赖原有数据，有些容器创建时需要加载已有数据，销毁时希望保留之前产生的数据，这类容器就需要用到容器持久化存储</p>
<p>Data volume<br>Data volume 本质是 Docker Host 文件系统中的目录或文件，能够直接被mount到容器的文件系统中</p>
<p>特点：<br>1、Data volume是目录或文件，不是块设备<br>2、容器可以读写volume中的数据<br>3、volume的数据因为在host上，但容器被销毁时，不会影响数据，所以它是可以持久保存的。</p>
<p>在使用上，软件放在镜像层内，软件的数据如web Server的网页，数据库的数据这些放在Data volume上</p>
<p>因为data volume是宿主机的一部分，所以目前volume无法设置容量。</p>
<p>docker提供两种类型volume<br>bind mount：宿主机上已经存在的目录或文件mount到容器。<br>优点：使用起来直观、高效、可以控制目录的读写权限，支持单个文件的mount<br>缺点：需要指定host 文件系统路径，限制了容器的可移值性，当需要将容器迁到其他host上，如果其他host上没有要mount的数据或数据不在相同目录时，操作会失败。  </p>
<p>docker managed volume：与bind mount最大区别是不需要指定mount 源，只需要指定容器内mount的目录。<br>优点：容器申请 mount docker manager volume时会自动在/var/lib/docker/volumes下生成一个目录，这样的话，容器移值性更好。<br>缺点：不支持控制读写权限，不支持单个文件mount。</p>
<h4 id="bind-mount"><a href="#bind-mount" class="headerlink" title="bind mount"></a>bind mount</h4><p>在宿主机上创建http目录</p>
<p>mkdir /root/http<br>echo “My test bind mount” &gt; /root/http/index.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d -p 80:80 -v /root/http/:/usr/local/apache2/htdocs httpd</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-v &lt;host path&gt;:&lt;container path&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl  http://127.0.0.1</div></pre></td></tr></table></figure>
<p>My test bind mount</p>
<p>将host的index.html更新看看，container内的是否也会根着改变<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &quot;My test bind mount test_2 &quot; &gt; /root/http/index.html</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl  http://127.0.0.1</div></pre></td></tr></table></figure>
<p>My test bind mount test_2</p>
<p>设置只读权限，这样就不能在container内对该目录进行修改了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d -p 80:80 -v /root/http/:/usr/local/apache2/htdocs:ro httpd</div></pre></td></tr></table></figure>
<p> <img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_21.png" alt=""></p>
<h4 id="docker-manged-volume"><a href="#docker-manged-volume" class="headerlink" title="docker manged volume"></a>docker manged volume</h4><p>manged volume最大特点是不需要指定源，只需要指定mount point就可以了<br>查看挂载的源</p>
<p> docker inspect 79af2997ca68</p>
<p> 关注mounts信息<br> <img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_22.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">当容器申请 manged volume时docker会在/var/lib/docker/volumes/下生成一个目录xxx/_data这个就是mount源。mount point指向以有的目录，容器内原有的数据会被复制到这个目录中</div></pre></td></tr></table></figure>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_23.png" alt=""></p>
<p>我们可以直接更新宿主机上的数据。</p>
<p>docker managed volume创建过程</p>
<p>1、容器启动时，简单告诉docker 我需要一个volume存放数据，帮我mount到容器xxx目录。<br>2、docker在/var/lib/docker/volumes/中生成一个随机目录作为mount源。<br>3、如果内mount的目录已经存在，则将数据复制到mount源。<br>4、将host上生成的目录挂载的container中。  </p>
<p>通过docker volume ls 查看 docker manged volume的容器</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_24.png" alt=""></p>
<p>docker inspect 查看volume<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_25.png" alt=""></p>
<p>bind mount和docker managed volume比较<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_35.png" alt=""></p>
<h4 id="数据共享"><a href="#数据共享" class="headerlink" title="数据共享"></a>数据共享</h4><p>容器和宿主机共享数据<br>1、两种类型的data volume它们均可以实现容器与host之间数据共享。<br>2、docker cp 或linux的cp命令将host数据cp到容器中。  </p>
<p>容器和容器间的数据共享<br>方法一：<br>将共享数据放到bind mount的源中然后mount到多个容器中。  </p>
<p>如搭建web集群<br>将宿主机目录共享到3个容器上，curl访问数据都一致  .<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_26.png" alt=""></p>
<p>修改宿主机文件，3个容器会同时更新。<br>方法二：<br>volume container<br>专门为其他容器提供volume的容器。<br>专门create出一个容器用来提供volume，volume container的卷可以是bind mount 也可以是docker manged volume。<br>如创建个容器 将/root/http通过bind mount或docker manged volume的方式挂上去，然后其他容器只需要挂这个容器即可。  </p>
<p>创建 volume container<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker create --name vc_data -v /root/http/:/usr/lolca/apache2/htdocs httpd</div></pre></td></tr></table></figure></p>
<p>因为volume container的作用只是提供数据，它本身不需要处于运行状态</p>
<p>其他容器 volume 使用volume container</p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_27.png" alt=""></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_28.png" alt="">  </p>
<p>查看  </p>
<p>[root@wan_test http]# docker inspect web1  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&quot;Mounts&quot;: [</div><div class="line">          &#123;</div><div class="line">              &quot;Type&quot;: &quot;bind&quot;,</div><div class="line">              &quot;Source&quot;: &quot;/root/http&quot;,</div><div class="line">              &quot;estination&quot;: &quot;/usr/local/apache2/htdocs&quot;,</div><div class="line">              &quot;Mode&quot;: &quot;&quot;,</div><div class="line">              &quot;RW&quot;: true,</div><div class="line">              &quot;Propagation&quot;: &quot;rprivate&quot;</div><div class="line">          &#125;</div><div class="line">      ],</div></pre></td></tr></table></figure>
<p>volume container的特点：<br>(1)与bind mount相比，不必为每一个容器指定host path，所有path都在volume contain 中定义好了，容器只需要与volume container关联，实现了容器与host解偶。<br>(2)使用 volume container的容器，其mount point是一致的，有利于配置规范的和标准，但也带来一定局限行，使用使要综合考虑。  </p>
<p>data-packed volume container  </p>
<p>volume container，数据还是在host上 data-packed volume container数据，将数据完全放到volume container中的称为data-packed volume container 。</p>
<p>原理<br>先将文件ADD 或cp到镜像中，然后在创建docker manged volume</p>
<p>使用Dockerfile build镜像<br>vim Dokerfile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FROM centos</div><div class="line">ADD http /usr/local/apache2/htdocs</div><div class="line">VOLUME /usr/local/apache2/htdocs</div></pre></td></tr></table></figure></p>
<p><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_29.png" alt="">  </p>
<p>查看volume<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_30.png" alt="">  </p>
<p>在dockerfile中指定了读取volume的数据，所以这里就不需要指定volume的mount point了  </p>
<p>启动http容器使用 data-packed volume container  </p>
<p>docker run -d -p 80:80 –volumes-from vc_data httpd<br><img src="http://ohx02qrb8.bkt.clouddn.com/docker_base_31.png" alt="">  </p>
<p>容器能正确读取volume中的数据，data-packed volume container是自包含的不依赖host提供数据，具有很强移值性，非常合适静态数据的场景，比如应用的配置信息，web Server的静态文件等.</p>
<p>data volume 生命周期  </p>
<p>备份  </p>
<p>备份host上对应的目录  </p>
<p>恢复<br>使用host上的备份恢复  </p>
<p>迁移<br>1、stop原用容器<br>2、将原目录mount到新容器  </p>
<p>销毁<br>销毁容器不会销毁bind mount   </p>
<p>data managed volume销毁需要docker rm -v 或docker volume rm xxx  </p>
<p>批量删除<br>docker volume rm $(docker volume ls -q)</p>
<p><a href="https://yeasy.gitbooks.io/docker_practice/content/network/linking.html" target="_blank" rel="external">https://yeasy.gitbooks.io/docker_practice/content/network/linking.html</a></p>

      
    </div>
    <div class="article-footer">
      
    </div>
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2017/10/30/docker_machine/" title="Docker machine(docker 多主机部署)"><i class="fa fa-angle-left" aria-hidden="true"></i>&nbsp;&nbsp;上一篇</a>
    </li>
    
    
    <li class="next">
      <a href="/2017/10/23/install_docker/" title="Docker安装">下一篇&nbsp;&nbsp;<i class="fa fa-angle-right" aria-hidden="true"></i></a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
  </div>
  
  </div>
</nav>
  


</main>

  
  <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.js"></script>
<script src="/js/application.js"></script>
  
    
    
    
        <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>
    
    
    
        


    
    
        
    
    



</body>
</html>